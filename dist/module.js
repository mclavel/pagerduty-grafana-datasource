define(["@grafana/data","@grafana/runtime","rxjs","react","@grafana/ui"],((e,t,r,n,o)=>(()=>{"use strict";var a={305:t=>{t.exports=e},545:e=>{e.exports=t},388:e=>{e.exports=o},650:e=>{e.exports=n},177:e=>{e.exports=r}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}};return a[e](r,r.exports,s),r.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var c={};return(()=>{s.r(c),s.d(c,{plugin:()=>b});var e=s(305),t=s(545),r=s(177);function n(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function o(e){return function(){var t=this,r=arguments;return new Promise((function(o,a){var i=e.apply(t,r);function s(e){n(i,o,a,s,c,"next",e)}function c(e){n(i,o,a,s,c,"throw",e)}s(void 0)}))}}class a extends e.DataSourceApi{query(t){var r=this;return o((function*(){const{range:n}=t,a=n.from.toISOString(),i=n.to.toISOString(),s=t.targets.map((c=o((function*(t){const n=new e.MutableDataFrame({refId:t.refId,fields:[{name:"time",type:e.FieldType.time},{name:"timeEnd",type:e.FieldType.time},{name:"title",type:e.FieldType.string},{name:"text",type:e.FieldType.string},{name:"id",type:e.FieldType.string}]});return(yield r.doRequestPaginated(t,a,i,25)).incidents.forEach((e=>{const t=new Date(e.created_at),r=null!==e.resolved_at?new Date(e.resolved_at):new Date(i),o=t.getTime(),a=r.getTime(),s=e.title,c=e.summary,u=e.incident_key;n.appendRow([o,a,s,c,u])})),n})),function(e){return c.apply(this,arguments)}));var c;return Promise.all(s).then((e=>({data:e})))}))()}doRequestPaginated(e,t,r,n){var a=this;return o((function*(){let o={incidents:[],more:!1},i=0;do{const s=yield a.doRequest(e,t,r,n,i);o.incidents=Array.prototype.concat(o.incidents,s.data.incidents),o.more=s.data.more,i++}while(o.more);return o}))()}doRequest(e,n,a,i,s){var c=this;return o((function*(){const o=(0,t.getBackendSrv)().fetch({method:"GET",url:c.url+"/pagerduty/incidents",params:{"service_ids[]":""===e.serviceId?[]:[e.serviceId],since:n,until:a,limit:i,offset:s*i},responseType:"json"});return(0,r.lastValueFrom)(o)}))()}testDatasource(){var e=this;return o((function*(){try{const t={serviceId:"",refId:""},r=yield e.doRequest(t,"","",25,0);return 200===r.status?{status:"success",message:"Success!"}:{status:"error",message:r.statusText}}catch(e){return{status:"error",message:"Error contacting remote datasource, please check the API key provided."}}}))()}constructor(e){var t;super(e),t=void 0,"url"in this?Object.defineProperty(this,"url",{value:t,enumerable:!0,configurable:!0,writable:!0}):this.url=t,this.url=e.url,this.annotations={}}}var i=s(650),u=s.n(i),l=s(388);function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){p(e,t,r[t])}))}return e}function y(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const b=new e.DataSourcePlugin(a).setConfigEditor((function(e){const{onOptionsChange:t,options:r}=e,{secureJsonFields:n}=r,o=r.secureJsonData||{};return u().createElement("div",{className:"gf-form-group"},u().createElement(l.InlineField,{label:"API Key",labelWidth:12},u().createElement(l.SecretInput,{isConfigured:n&&n.apiKey,value:o.apiKey||"",placeholder:"PagerDuty read-only api key",width:40,onReset:()=>{t(y(d({},r),{secureJsonFields:y(d({},r.secureJsonFields),{apiKey:!1}),secureJsonData:y(d({},r.secureJsonData),{apiKey:""})}))},onChange:e=>{t(y(d({},r),{secureJsonData:{apiKey:e.target.value}}))}})))})).setQueryEditor((function({query:e,onChange:t}){const{serviceId:r}=e;return u().createElement("div",{className:"gf-form"},u().createElement(l.InlineField,{label:"Service Id",labelWidth:16,tooltip:"Not used yet"},u().createElement(l.Input,{onChange:r=>{var n,o;t((n=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){f(e,t,r[t])}))}return e}({},e),o=null!=(o={serviceId:r.target.value})?o:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(o)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(o,e))})),n))},value:r||""})))}))})(),c})()));
//# sourceMappingURL=module.js.map